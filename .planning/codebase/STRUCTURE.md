# Codebase Structure

**Analysis Date:** 2026-02-27

## Directory Layout

```
tangle/
├── src/                        # Application source code
│   ├── components/             # React components
│   │   ├── FilePanel/          # Left sidebar — file upload & management
│   │   ├── Graph/              # Right panel — graph visualization
│   │   └── ui/                 # Shared UI primitives
│   ├── lib/                    # Business logic layers
│   │   ├── parser.ts           # Excel parsing + reference extraction
│   │   └── graph.ts            # Graph building + layout algorithms
│   ├── App.tsx                 # Root component & global state
│   ├── types.ts                # Shared TypeScript interfaces
│   ├── main.tsx                # Vite entry point
│   └── index.css               # Global styles + React Flow overrides
├── src-tauri/                  # Tauri desktop app wrapper
├── public/                     # Static assets
├── dist/                       # Build output (generated)
├── .planning/                  # GSD planning documents
├── .husky/                     # Git pre-commit hooks
├── eslint.config.js            # ESLint configuration
├── vite.config.ts              # Vite build configuration
├── tsconfig.json               # TypeScript configuration
├── package.json                # Dependencies and scripts
└── index.html                  # HTML entry point (single page)
```

## Directory Purposes

**src/:**
- Purpose: All application source code
- Contains: React components, business logic, types, styles
- Key files: App.tsx (root), main.tsx (entry)

**src/components/:**
- Purpose: Reusable React components organized by feature
- Contains: Functional components, custom React Flow nodes/edges, event handlers
- Key files: FilePanel.tsx, GraphView.tsx

**src/components/FilePanel/:**
- Purpose: Left sidebar — file upload, workbook/sheet listing, file management
- Contains: FilePanel.tsx with drag-drop, file selection, expansion UI
- Key files: FilePanel.tsx (single file)

**src/components/Graph/:**
- Purpose: Right panel — interactive graph canvas
- Contains: GraphView.tsx with React Flow setup, custom node/edge components, selection/filter logic
- Key files: GraphView.tsx (single large file)

**src/components/ui/:**
- Purpose: Shared UI building blocks
- Contains: TangleLogo component, reusable UI elements
- Key files: TangleLogo.tsx

**src/lib/:**
- Purpose: Business logic — parsing and graph algorithms
- Contains: No React; pure computation functions
- Key files: parser.ts (Excel → WorkbookFile), graph.ts (WorkbookFile → React Flow nodes/edges)

**src-tauri/:**
- Purpose: Tauri v2 desktop app wrapper
- Contains: Tauri configuration, window setup
- Generated by: `npm run tauri:build` (creates .exe)

**dist/:**
- Purpose: Build output
- Generated: By `npm run build`
- Contents: Bundled JavaScript, CSS, assets

## Key File Locations

**Entry Points:**

- `src/main.tsx`: Vite entry — mounts React app to #root
- `index.html`: Single-page app root HTML
- `src/App.tsx`: React root component — manages global state and layout

**Configuration:**

- `vite.config.ts`: Vite dev server + build config (React, Tailwind plugins)
- `tsconfig.json`: TypeScript configuration (references app & node configs)
- `tsconfig.app.json`: App-specific TS config (strict mode, module resolution)
- `eslint.config.js`: Linting rules (ESLint v9 flat config)
- `package.json`: Dependencies, scripts, lint-staged pre-commit rules

**Core Logic:**

- `src/lib/parser.ts`: XLSX parsing, reference extraction, named range resolution
- `src/lib/graph.ts`: Node/edge building, layout algorithms (Dagre, grouped, overview)

**Components:**

- `src/components/FilePanel/FilePanel.tsx`: Upload form, workbook list, sheet expansion, file actions
- `src/components/Graph/GraphView.tsx`: React Flow canvas, SheetNode/WeightedEdge renderers, graph state management
- `src/components/ui/TangleLogo.tsx`: Logo component with optional text

**Types:**

- `src/types.ts`: Shared interfaces (WorkbookFile, ParsedSheet, SheetReference, SheetWorkload, NamedRange, EdgeReference, NodeData, EdgeData, LayoutMode, EdgeKind)

**Styling:**

- `src/index.css`: Global styles, React Flow dark theme overrides, scrollbar styling

## Naming Conventions

**Files:**

- Components: PascalCase, e.g., `FilePanel.tsx`, `GraphView.tsx`, `TangleLogo.tsx`
- Library modules: camelCase, e.g., `parser.ts`, `graph.ts`
- Types: `types.ts`
- Styles: `index.css`

**Directories:**

- Feature components: PascalCase, e.g., `FilePanel/`, `Graph/`, `ui/`
- Logic layers: camelCase, e.g., `lib/`

**Variables & Functions:**

- camelCase: `workbooks`, `parseWorkbook()`, `buildGraph()`, `extractReferences()`
- CONSTANTS: UPPERCASE, e.g., `EXCEL_EXTENSIONS`, `CELL_RE`, `NODE_W`, `NODE_H`, `CLUSTER_PAD`
- React state hooks: camelCase, e.g., `const [nodes, setNodes]`, `const [dragging, setDragging]`
- Custom hooks: `use` prefix (none in current codebase; extract when logic is reusable)

**React Components:**

- Functional components with hooks
- Named exports (can be imported with any alias)
- Props interfaces end with `Props`, e.g., `FilePanelProps`, `NodeProps<NodeData>`
- Custom node/edge types: `SheetNode`, `WeightedEdge`

**IDs & Keys:**

- Sheet node ID: `{workbookName}::{sheetName}` (from `sheetNodeId()`)
- File node ID: `[file]{workbookName}` (from `fileNodeId()`)
- Named range node ID: `[nr]{workbookName}::{name}` (from graph.ts line 148)
- Cluster node ID: `[cluster]{workbookName}` (from `computeClusterNodes()`)
- Edge ID: `{sourceId}->{targetId}` (from `edgeId()`)

## Where to Add New Code

**New Feature:**

- Feature logic: `src/lib/` (if no UI) or component in `src/components/{FeatureName}/`
- If affecting graph: Update `src/lib/graph.ts` buildGraph() or layout functions
- If affecting parser: Update `src/lib/parser.ts` extractReferences() or add extractor function
- Types: Add interfaces to `src/types.ts`
- Tests: Create `src/__tests__/` or place `*.test.ts(x)` alongside source

**New Component/Module:**

- Reusable UI component: `src/components/ui/{ComponentName}.tsx`
- Feature component: `src/components/{FeatureName}/{FeatureName}.tsx`
- Pure logic: `src/lib/{moduleName}.ts`
- State hook: `src/hooks/{hookName}.ts` (create if extracting reusable state logic)

**Utilities:**

- Shared helpers: `src/lib/` (preferred) or `src/utils/` (create if many small utilities)
- Example: `stripExcelExt()` in graph.ts, cell reference regex patterns in parser.ts

## Special Directories

**src-tauri/:**
- Purpose: Tauri v2 desktop wrapper
- Generated: Scaffolded by `npm install @tauri-apps/cli`
- Committed: Yes (configuration only, binaries in target/ ignored)

**dist/:**
- Purpose: Production build output
- Generated: By `npm run build`
- Committed: No (.gitignore)

**.planning/:**
- Purpose: GSD (Claude workflowing) planning documents
- Contents: ARCHITECTURE.md, STRUCTURE.md, CONVENTIONS.md, TESTING.md, CONCERNS.md (as created)
- Committed: Yes

**.husky/:**
- Purpose: Git pre-commit hooks (ESLint max-warnings 0)
- Committed: Yes

## File Dependencies

**Dependency graph (top-level):**

```
App.tsx
  ├── FilePanel/FilePanel.tsx
  │   └── lib/parser.ts (parseWorkbook)
  │       └── types.ts
  └── Graph/GraphView.tsx
      ├── lib/graph.ts (buildGraph, computeClusterNodes)
      │   ├── types.ts
      │   └── lib/parser.ts (EXCEL_EXT_RE, stripExcelExt)
      ├── types.ts
      └── @xyflow/react (React Flow)

lib/parser.ts
  ├── xlsx (SheetJS)
  └── types.ts

lib/graph.ts
  ├── @dagrejs/dagre (layout)
  ├── @xyflow/react (Node, Edge, MarkerType)
  └── types.ts

components/ui/TangleLogo.tsx
  (no dependencies beyond React)

index.css
  @import "tailwindcss"
  (React Flow CSS overrides)
```

---

*Structure analysis: 2026-02-27*
