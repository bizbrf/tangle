---
phase: 04-e2e-tests
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/FilePanel/FilePanel.tsx
  - src/components/Graph/GraphView.tsx
  - tests/fixtures/not-excel.txt
autonomous: true
requirements:
  - E2E-01
  - E2E-02
  - E2E-03
  - E2E-04
  - E2E-05
  - E2E-06
  - E2E-07
  - E2E-08
  - E2E-09
  - E2E-10
  - E2E-11
  - E2E-12
  - E2E-13
  - E2E-14
  - E2E-15

must_haves:
  truths:
    - "Every UI element that E2E tests need to locate has a data-testid attribute in the DOM"
    - "A plain-text not-excel.txt fixture exists for non-Excel upload tests"
    - "The app builds without TypeScript errors after all attribute additions"
  artifacts:
    - path: "src/components/FilePanel/FilePanel.tsx"
      provides: "data-testid on upload-error, file-list-item, sheet-list-item, eye-toggle"
      contains: "data-testid"
    - path: "src/components/Graph/GraphView.tsx"
      provides: "data-testid on sheet-node (all 3 branches), detail-panel, detail-panel-title, workload-metrics, layout-graph/grouped/overview, edge-filter-*, focus-panel"
      contains: "data-testid"
    - path: "tests/fixtures/not-excel.txt"
      provides: "non-Excel file for E2E-13 upload error test"
  key_links:
    - from: "GraphView.tsx SheetNode named-range branch"
      to: "data-testid=\"sheet-node\""
      via: "root div attribute"
      pattern: "data-testid=\"sheet-node\""
    - from: "GraphView.tsx SheetNode file-node branch"
      to: "data-testid=\"sheet-node\""
      via: "root div attribute"
      pattern: "data-testid=\"sheet-node\""
    - from: "GraphView.tsx SheetNode regular branch"
      to: "data-testid=\"sheet-node\""
      via: "root div attribute"
      pattern: "data-testid=\"sheet-node\""
---

<objective>
Instrument the React source with data-testid attributes and create the not-excel.txt fixture so Playwright tests can locate elements reliably.

Purpose: All E2E specs depend on stable, CSS-independent selectors. Zero data-testid attributes currently exist in the source — they must all be added before any test can be written.
Output: Modified FilePanel.tsx and GraphView.tsx with complete data-testid coverage; tests/fixtures/not-excel.txt created.
</objective>

<execution_context>
@C:/Users/chase/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/chase/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/FilePanel/FilePanel.tsx
@src/components/Graph/GraphView.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add data-testid attributes to FilePanel.tsx</name>
  <files>src/components/FilePanel/FilePanel.tsx</files>
  <action>
Add four data-testid attributes to FilePanel.tsx. Do NOT change any logic, styles, class names, or event handlers — only add the attribute to existing elements.

1. Error paragraph (line ~202): add `data-testid="upload-error"` to the `<p>` element inside `{error && (...)}`.
   Before: `<p className="mx-3 mb-2 text-xs px-2 py-1.5 rounded-lg"`
   After: `<p data-testid="upload-error" className="mx-3 mb-2 text-xs px-2 py-1.5 rounded-lg"`

2. File row outer div (line ~231): add `data-testid="file-list-item"` to the group div (the one with `className="group relative flex items-center justify-between rounded-lg px-2.5 py-2 cursor-pointer transition-all duration-150"`).
   Add the attribute immediately after the opening `<div` tag, before `className=`.

3. Eye toggle button (line ~260): add `data-testid="eye-toggle"` to the `<button>` inside `{onToggleHidden && (...)}`  that has `onClick={(e) => { e.stopPropagation(); onToggleHidden(wb.name); }}`.
   Add the attribute immediately after `<button`.

4. Sheet row div (line ~299): add `data-testid="sheet-list-item"` to each `<div` rendered by `wb.sheets.map((sheet) => (...))`. The target div is the one that starts `<div key={sheet.sheetName}`.
   Note: `key` is a React prop, not a DOM attribute. Add `data-testid="sheet-list-item"` as a separate attribute alongside it.
  </action>
  <verify>
    <automated>cd C:/Users/chase/projects/tangle && npx tsc --noEmit 2>&1 | head -20</automated>
  </verify>
  <done>FilePanel.tsx compiles cleanly and contains data-testid="upload-error", data-testid="file-list-item", data-testid="eye-toggle", data-testid="sheet-list-item"</done>
</task>

<task type="auto">
  <name>Task 2: Add data-testid attributes to GraphView.tsx</name>
  <files>src/components/Graph/GraphView.tsx</files>
  <action>
Add data-testid attributes to 9 locations in GraphView.tsx. Do NOT change logic, styles, or event handlers — only add the attribute.

**SheetNode — 3 branches (all must get data-testid="sheet-node"):**

1. Named-range branch (line ~238): The `return (` block starts with a bare `<div` that has an inline style object. Add `data-testid="sheet-node"` to that root div:
   Before: `<div`
   After: `<div data-testid="sheet-node"`

2. File-node branch (line ~323): Same pattern — the `return (` block starts with a bare `<div`. Add `data-testid="sheet-node"`:
   Before: `<div`
   After: `<div data-testid="sheet-node"`

3. Regular sheet branch (line ~395): The final `return (` in SheetNode renders `<div style={containerStyle}`. Add `data-testid="sheet-node"`:
   Before: `<div`
   After: `<div data-testid="sheet-node"`

**DetailPanel component (line ~658):**

4. Panel outer div — the `return (` in DetailPanel renders `<div style={panelStyle}>`. Add `data-testid="detail-panel"`:
   Before: `<div style={panelStyle}>`
   After: `<div data-testid="detail-panel" style={panelStyle}>`

5. Panel header title span (line ~668) — the `<span` with `style={{ fontSize: 10, fontWeight: 700 ... }}` that renders the title text. Add `data-testid="detail-panel-title"`:
   Before: `<span style={{ fontSize: 10, fontWeight: 700, textTransform: 'uppercase', letterSpacing: '0.1em', color: C.textMuted }}>`
   After: `<span data-testid="detail-panel-title" style={{ fontSize: 10, fontWeight: 700, textTransform: 'uppercase', letterSpacing: '0.1em', color: C.textMuted }}>`

6. Workload metrics grid (line ~775) — inside `{node.data.workload && (<> ... </>)}`, the second `<div` with `style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 8 }}` that maps over the four workload metrics. Add `data-testid="workload-metrics"`:
   Before: `<div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 8 }}>`
   After: `<div data-testid="workload-metrics" style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 8 }}>`
   Note: There is also an edge-stats grid above it — target the one INSIDE the `node.data.workload &&` block.

**Toolbar component (line ~950):**

7. Layout mode buttons — inside `LAYOUT_OPTIONS.map(({ mode, label, icon }) => { ... return (<button key={mode} onClick=...)`. Add `data-testid={\`layout-${mode}\`}` to the button:
   Before: `<button`
   After: `<button data-testid={\`layout-${mode}\`}`
   This produces data-testid="layout-graph", "layout-grouped", "layout-overview" automatically.

**EdgeKindFilterBar component (line ~1020):**

8. Edge filter buttons — inside `visibleOptions.map(({ kind, label, color }) => { const on = filter[kind]; return (<button key={kind} onClick=...)`. Add `data-testid={\`edge-filter-${kind}\`}`:
   Before: `<button`
   After: `<button data-testid={\`edge-filter-${kind}\`}`
   This produces data-testid="edge-filter-internal", "edge-filter-cross-file", "edge-filter-external", "edge-filter-named-range".

**Focus Mode Controls (line ~1435):**

9. Focus panel outer div — inside `{focusNodeId && (<div style={{ position: 'absolute', top: 12, right: 16, ...}}>`. Add `data-testid="focus-panel"`:
   Before: `<div style={{`
   After: `<div data-testid="focus-panel" style={{`
  </action>
  <verify>
    <automated>cd C:/Users/chase/projects/tangle && npx tsc --noEmit 2>&1 | head -20</automated>
  </verify>
  <done>GraphView.tsx compiles cleanly and contains: data-testid="sheet-node" (3 occurrences), data-testid="detail-panel", data-testid="detail-panel-title", data-testid="workload-metrics", data-testid with layout-* template literal, data-testid with edge-filter-* template literal, data-testid="focus-panel"</done>
</task>

<task type="auto">
  <name>Task 3: Create not-excel.txt fixture</name>
  <files>tests/fixtures/not-excel.txt</files>
  <action>
Create a plain-text file at tests/fixtures/not-excel.txt with content:
"This is not an Excel file."

This file is used by E2E-13 to trigger the "Only Excel files (.xlsx, .xls, .xlsm, .xlsb) are supported." error path in FilePanel.tsx. The content does not matter — only the .txt extension matters for the filter check.
  </action>
  <verify>
    <automated>test -f C:/Users/chase/projects/tangle/tests/fixtures/not-excel.txt && echo "exists" || echo "missing"</automated>
  </verify>
  <done>tests/fixtures/not-excel.txt exists with plain text content</done>
</task>

</tasks>

<verification>
After all tasks, run the full build to confirm no regressions:
cd C:/Users/chase/projects/tangle && npm run build 2>&1 | tail -10

Verify data-testid presence in source:
grep -c "data-testid" C:/Users/chase/projects/tangle/src/components/FilePanel/FilePanel.tsx
grep -c "data-testid" C:/Users/chase/projects/tangle/src/components/Graph/GraphView.tsx
</verification>

<success_criteria>
- FilePanel.tsx has exactly 4 data-testid attributes: upload-error, file-list-item, sheet-list-item, eye-toggle
- GraphView.tsx has data-testid on all three SheetNode branches (="sheet-node"), DetailPanel outer div, header span, workload metrics grid, layout buttons (template literal), edge filter buttons (template literal), and focus panel div
- tests/fixtures/not-excel.txt exists
- npm run build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-e2e-tests/04-01-SUMMARY.md`
</output>
